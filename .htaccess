# Jessie CMS .htaccess
# Clean routing — MVC + legacy admin pages
# Updated: 2026-02-09

Options +FollowSymLinks
DirectoryIndex index.php
DirectorySlash Off

RewriteEngine On
RewriteBase /

# ============================================================
# STATIC ASSETS & SECURITY
# ============================================================

# Allow theme-builder assets
RewriteRule ^core/theme-builder/(js|css)/.*$ - [L]

# Block sensitive directories
RewriteRule ^(app|core|config|storage|modules)/ - [F,L]
RewriteRule ^vendor/ - [F,L]

# Static assets
RewriteRule ^assets/(.*)$ public/assets/$1 [L]
RewriteRule ^uploads/(.*)$ public/uploads/$1 [L]
RewriteRule ^favicon\.ico$ public/favicon.ico [L]
RewriteRule ^robots\.txt$ public/robots.txt [L]
RewriteRule ^sitemap\.xml$ sitemap.php [L]

# ============================================================
# PREVIEW SYSTEM
# ============================================================
RewriteRule ^tb-preview/([^/]+)/?$ preview.php?type=tb&slug=$1 [QSA,L]
RewriteRule ^preview/tb/([0-9]+)/?$ preview.php?type=tb&id=$1 [QSA,L]
RewriteRule ^preview/tb/slug/([^/]+)/?$ preview.php?type=tb&slug=$1 [QSA,L]
RewriteRule ^preview/page/([0-9]+)/?$ preview.php?type=page&id=$1 [QSA,L]
RewriteRule ^preview/page/slug/([^/]+)/?$ preview.php?type=page&slug=$1 [QSA,L]
RewriteRule ^preview/article/([0-9]+)/?$ preview.php?type=article&id=$1 [QSA,L]
RewriteRule ^preview/template/new/?$ preview.php?type=template&id=0 [QSA,L]
RewriteRule ^preview/template/([0-9]+)/?$ preview.php?type=template&id=$1 [QSA,L]

# ============================================================
# AUTH (legacy login/logout)
# ============================================================
RewriteRule ^admin/login/?$ admin/login.php [QSA,L]
RewriteRule ^admin/logout/?$ admin/logout.php [QSA,L]

# ============================================================
# LEGACY ADMIN PAGES (served directly as .php)
# Only pages that actually exist and have no MVC equivalent
# ============================================================

# AI SEO tools (12 pages)
RewriteRule ^admin/ai-seo-assistant/?$ admin/ai-seo-assistant.php [L]
RewriteRule ^admin/ai-seo-dashboard/?$ admin/ai-seo-dashboard.php [L]
RewriteRule ^admin/ai-seo-content/?$ admin/ai-seo-content.php [L]
RewriteRule ^admin/ai-seo-bulk/?$ admin/ai-seo-bulk.php [L]
RewriteRule ^admin/ai-seo-timeline/?$ admin/ai-seo-timeline.php [L]
RewriteRule ^admin/ai-seo-images/?$ admin/ai-seo-images.php [L]
RewriteRule ^admin/ai-seo-links/?$ admin/ai-seo-links.php [L]
RewriteRule ^admin/setup-wizard/?$ admin/setup-wizard.php [L]
RewriteRule ^admin/ai-seo-pages/?$ admin/ai-seo-content.php?type=pages [L,R=301,QSA]
RewriteRule ^admin/ai-seo-articles/?$ admin/ai-seo-content.php?type=articles [L,R=301,QSA]
RewriteRule ^admin/ai-seo-keywords/?$ admin/ai-seo-keywords.php [L]
RewriteRule ^admin/ai-seo-competitors/?$ admin/ai-seo-competitors.php [L]
RewriteRule ^admin/ai-seo-research/?$ admin/ai-seo-research.php [L]
RewriteRule ^admin/ai-seo-linking/?$ admin/ai-seo-linking.php [L]
RewriteRule ^admin/ai-seo-brief/?$ admin/ai-seo-brief.php [L]
RewriteRule ^admin/ai-seo-decay/?$ admin/ai-seo-decay.php [L]
RewriteRule ^admin/ai-seo-schema/?$ admin/ai-seo-schema.php [L]
RewriteRule ^admin/ai-seo-reports/?$ admin/ai-seo-reports.php [L]

# AI Tools (15 pages)
RewriteRule ^admin/ai-content-creator/?$ admin/ai-content-creator.php [L]
RewriteRule ^admin/ai-copywriter/?$ admin/ai-copywriter.php [L]
RewriteRule ^admin/ai-content-rewrite/?$ admin/ai-content-rewrite.php [L]
RewriteRule ^admin/ai-translate/?$ admin/ai-translate.php [L]
RewriteRule ^admin/ai-images/?$ admin/ai-images.php [L]
RewriteRule ^admin/ai-alt-generator/?$ admin/ai-alt-generator.php [L]
RewriteRule ^admin/ai-forms/?$ admin/ai-forms.php [L]
RewriteRule ^admin/ai-landing/?$ admin/ai-landing.php [L]
RewriteRule ^admin/ai-student-materials/?$ admin/ai-student-materials.php [L]
RewriteRule ^admin/ai-email-campaign/?$ admin/ai-email-campaign.php [L]
RewriteRule ^admin/ai-workflow-generator/?$ admin/ai-workflow-generator.php [L]
RewriteRule ^admin/ai-insights/?$ admin/ai-insights.php [L]
RewriteRule ^admin/ai-logs/?$ admin/ai-logs.php [L]
RewriteRule ^admin/ai-settings/?$ admin/ai-settings.php [L]
RewriteRule ^admin/ai-components/?$ admin/ai-components.php [L]

# Legacy SEO (6 pages)
RewriteRule ^admin/seo/?$ admin/seo.php [L]
RewriteRule ^admin/seo-robots/?$ admin/seo-robots.php [L]
RewriteRule ^admin/seo-sitemap/?$ admin/seo-sitemap.php [L]

# Content tools
RewriteRule ^admin/content-quality/?$ admin/content-quality.php [L]
RewriteRule ^admin/content-suggestions/?$ admin/content-suggestions.php [L]

# N8n / Workflows
RewriteRule ^admin/n8n-workflows/?$ admin/n8n-workflows.php [L]
RewriteRule ^admin/n8n-workflow-builder/?$ admin/n8n-workflow-builder.php [L]

# Other standalone legacy pages
RewriteRule ^admin/navigation/?$ admin/navigation.php [L]
RewriteRule ^admin/settings/?$ admin/settings.php [L]
RewriteRule ^admin/clear-cache/?$ admin/clear-cache.php [L]

# Serve existing .php files directly
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^admin/.*\.php$ - [L]

# ============================================================
# MVC ROUTES (all go to index.php → Router)
# ============================================================

# Dashboard
RewriteRule ^admin/?$ index.php [QSA,L]
RewriteRule ^admin/dashboard/?$ index.php [QSA,L]

# Pages CRUD
RewriteRule ^admin/pages(/.*)?$ index.php [QSA,L]

# Articles CRUD
RewriteRule ^admin/articles(/.*)?$ index.php [QSA,L]

# Categories CRUD
RewriteRule ^admin/categories(/.*)?$ index.php [QSA,L]

# Users CRUD
RewriteRule ^admin/users(/.*)?$ index.php [QSA,L]

# Comments
RewriteRule ^admin/comments(/.*)?$ index.php [QSA,L]

# Menus CRUD
RewriteRule ^admin/menus(/.*)?$ index.php [QSA,L]

# Widgets CRUD
RewriteRule ^admin/widgets(/.*)?$ index.php [QSA,L]

# Galleries CRUD
RewriteRule ^admin/galleries(/.*)?$ index.php [QSA,L]

# Media Library
RewriteRule ^admin/media(/.*)?$ index.php [QSA,L]

# Themes
RewriteRule ^admin/themes(/.*)?$ index.php [QSA,L]

# Theme Editor
RewriteRule ^admin/theme-editor(/.*)?$ index.php [QSA,L]

# Logs
RewriteRule ^admin/logs(/.*)?$ index.php [QSA,L]

# URLs
RewriteRule ^admin/urls(/.*)?$ index.php [QSA,L]

# Search
RewriteRule ^admin/search(/.*)?$ index.php [QSA,L]

# Backup
RewriteRule ^admin/backup(/.*)?$ index.php [QSA,L]

# Content blocks
RewriteRule ^admin/content(/.*)?$ index.php [QSA,L]

# Extensions/Plugins
RewriteRule ^admin/plugins(/.*)?$ index.php [QSA,L]

# Migrations
RewriteRule ^admin/migrations(/.*)?$ index.php [QSA,L]

# Maintenance
RewriteRule ^admin/maintenance(/.*)?$ index.php [QSA,L]

# Email
RewriteRule ^admin/email-queue(/.*)?$ index.php [QSA,L]
RewriteRule ^admin/email-campaigns(/.*)?$ index.php [QSA,L]
RewriteRule ^admin/email-settings(/.*)?$ index.php [QSA,L]

# Notifications
RewriteRule ^admin/notifications(/.*)?$ index.php [QSA,L]

# Analytics
RewriteRule ^admin/analytics(/.*)?$ index.php [QSA,L]

# Modules
RewriteRule ^admin/modules(/.*)?$ index.php [QSA,L]

# Profile
RewriteRule ^admin/profile(/.*)?$ index.php [QSA,L]

# Security
RewriteRule ^admin/security-dashboard/?$ index.php [QSA,L]

# GDPR
RewriteRule ^admin/gdpr-tools/?$ index.php [QSA,L]

# Version Control
RewriteRule ^admin/version-control(/.*)?$ index.php [QSA,L]

# Scheduler
RewriteRule ^admin/scheduler(/.*)?$ index.php [QSA,L]

# Automations
RewriteRule ^admin/automations(/.*)?$ index.php [QSA,L]
RewriteRule ^admin/automation-rules(/.*)?$ index.php [QSA,L]

# N8n MVC routes
RewriteRule ^admin/n8n-bindings(/.*)?$ index.php [QSA,L]
RewriteRule ^admin/n8n-settings(/.*)?$ index.php [QSA,L]

# Jessie Theme Builder
RewriteRule ^admin/jessie-theme-builder(/.*)?$ index.php [QSA,L]

# JTB Website Builder
RewriteRule ^admin/jtb(/.*)?$ index.php [QSA,L]

# JTB API
RewriteRule ^api/jtb(/.*)?$ index.php [QSA,L]

# Frontend blog
RewriteRule ^blog(/.*)?$ index.php [QSA,L]

# ============================================================
# CATCH-ALL — everything else to MVC router
# ============================================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# ============================================================
# FILE ACCESS RULES
# ============================================================

# Allow Font Awesome icons JSON
<FilesMatch "^fa-icons\.json$">
    Require all granted
</FilesMatch>

# Block sensitive files
<FilesMatch "\.(env|log|lock|yml|yaml|ini|sql|bak|backup)$">
    Require all denied
</FilesMatch>

# Block dotfiles
<FilesMatch "^\.">
    Require all denied
</FilesMatch>
