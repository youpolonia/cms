{
  "dashboard": {
    "title": "CMS Performance Dashboard",
    "panels": [
      {
        "title": "System Resources",
        "type": "row",
        "panels": [
          {
            "title": "CPU Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode='idle'}[5m])) * 100)",
                "legendFormat": "{{instance}}"
              }
            ]
          },
          {
            "title": "Memory Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "(node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / node_memory_MemTotal_bytes * 100",
                "legendFormat": "Used"
              }
            ]
          }
        ]
      },
      {
        "title": "Application Performance",
        "type": "row",
        "panels": [
          {
            "title": "Response Times",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, route))",
                "legendFormat": "95th pct - {{route}}"
              }
            ]
          },
          {
            "title": "Error Rates",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(rate(http_requests_total{status=~'5..'}[5m])) by (route) / sum(rate(http_requests_total[5m])) by (route) * 100",
                "legendFormat": "{{route}}"
              }
            ]
          }
        ]
      },
      {
        "title": "Database Performance",
        "type": "row",
        "panels": [
          {
            "title": "Query Duration",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, sum(rate(db_query_duration_seconds_bucket[5m])) by (le, query_type))",
                "legendFormat": "{{query_type}}"
              }
            ]
          },
          {
            "title": "Connection Pool",
            "type": "graph",
            "targets": [
              {
                "expr": "db_connections_active",
                "legendFormat": "Active"
              },
              {
                "expr": "db_connections_idle",
                "legendFormat": "Idle"
              }
            ]
          }
        ]
      },
      {
        "title": "Caching Metrics",
        "type": "row",
        "panels": [
          {
            "title": "Cache Hit Ratio",
            "type": "graph",
            "targets": [
              {
                "expr": "cache_hits_total / (cache_hits_total + cache_misses_total) * 100",
                "legendFormat": "Hit Ratio"
              }
            ]
          },
          {
            "title": "Cache Operations",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(cache_operations_total[5m])",
                "legendFormat": "{{operation}}"
              }
            ]
          }
        ]
      },
      {
        "title": "Version Control Analytics",
        "type": "row",
        "panels": [
          {
            "title": "Comparison Operation Metrics",
            "type": "row",
            "panels": [
              {
                "title": "Comparison Latency (95th %ile)",
                "type": "graph",
                "targets": [
                  {
                    "expr": "histogram_quantile(0.95, sum(rate(version_comparison_duration_seconds_bucket[5m])) by (le, comparison_type))",
                    "legendFormat": "{{comparison_type}}"
                  }
                ],
                "alert": {
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [1],
                        "type": "gt"
                      },
                      "query": {
                        "params": ["A", "5m", "now"]
                      },
                      "type": "query"
                    }
                  ]
                }
              },
              {
                "title": "Memory Usage During Diffs",
                "type": "graph",
                "targets": [
                  {
                    "expr": "avg(version_diff_memory_bytes) by (content_type)",
                    "legendFormat": "{{content_type}}"
                  }
                ]
              }
            ]
          },
          {
            "title": "Version Operation Frequency",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(rate(version_operations_total[5m])) by (operation)",
                "legendFormat": "{{operation}}"
              }
            ]
          },
          {
            "title": "Comparison Cache Efficiency",
            "type": "graph",
            "targets": [
              {
                "expr": "version_cache_hit_ratio * 100",
                "legendFormat": "Hit Ratio"
              },
              {
                "expr": "rate(version_cache_misses_total[5m])",
                "legendFormat": "Misses"
              }
            ]
          },
          {
            "title": "Comparison Mode Distribution",
            "type": "piechart",
            "targets": [
              {
                "expr": "sum(version_comparison_modes_total) by (mode)",
                "legendFormat": "{{mode}}"
              }
            ]
          },
          {
            "title": "Comparison Error Rates",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(rate(version_comparison_errors_total[5m])) by (error_type)",
                "legendFormat": "{{error_type}}"
              }
            ]
          }
        ]
      }
    ],
    "templating": {
      "list": [
        {
          "name": "environment",
          "query": "label_values(http_requests_total, environment)"
        }
      ]
    },
    "refresh": "1m"
  }
}
