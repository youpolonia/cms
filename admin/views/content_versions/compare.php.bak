<?php
/**
 * Content Version Comparison View
 * User: krala
 * Date: 2025-07-05
 */

// Get version data from controller
$version1 = $data['version1'] ?? [];
$version2 = $data['version2'] ?? [];
$contentId = $data['content_id'] ?? 0;
$backUrl = admin_url("content/versions/history/{$contentId}");

// Admin header
require_once __DIR__ . '/../../includes/admin_header.php';


<div class="admin-container">
    <div class="admin-header">
        <h1>Version Comparison</h1>
        <a href="<?= $backUrl ?>" class="btn btn-back">
            &larr; Back to History
        </a>
    </div>

    <div class="version-metadata">
        <div class="metadata-left">
            <h3>Version <?= $version1['version_number'] ?? '' ?></h3>
            <p>Modified: <?= $version1['modified_at'] ?? '' ?></p>
            <p>Author: <?= $version1['author_name'] ?? '' ?></p>
        </div>
        <div class="metadata-right">
            <h3>Version <?= $version2['version_number'] ?? '' ?></h3>
            <p>Modified: <?= $version2['modified_at'] ?? '' ?></p>
            <p>Author: <?= $version2['author_name'] ?? '' ?></p>
        </div>
    </div>

    <?php
    // Get diff results
    $diff = \App\Helpers\VersionHelpers::text_diff(
        $version1['content'] ?? '',
        $version2['content'] ?? '',
        true // HTML-aware diff
    );
    
    
    <div class="version-comparison">
        <?= $diff['sideBySide']  ?>
    </div>
</div>

<style>
.admin-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}
.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
.version-metadata {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 4px;
}
.version-comparison {
    display: flex;
    flex-direction: column;
    gap: 1px;
}
.diff-line {
    display: flex;
    border-bottom: 1px solid #eee;
}
.diff-left, .diff-right {
    flex: 1;
    padding: 5px 10px;
    white-space: pre-wrap;
}
.diff-left {
    background: #fff;
    border-right: 1px solid #eee;
}
.diff-right {
    background: #fff;
}
.diff-added {
    background-color: #e6ffed;
}
.diff-removed {
    background-color: #ffeef0;
}
.btn-back {
    padding: 8px 15px;
    background: #6c757d;
    color: white;
    text-decoration: none;
    border-radius: 4px;
}
.btn-back:hover {
    background: #5a6268;
}
</style>

<?php
// Admin footer
require_once __DIR__ . '/../../includes/admin_footer.php';
